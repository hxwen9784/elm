### 代码逻辑梳理
本次比赛目标有两个，一是从候选行为中预测 wave 下一次行为，二是针对预测出来的行为，预测该行为的完成时间。完整代码包括以下几个部分，数据合并、预测行为的数据处理与特征构造、预测行为的建模过程、预测时间的数据预处理与特征构造、预测时间的建模过程。

#### 数据合并
第一部分目的是构造包含标签的标准数据集和整合分散在各个日期文件中的数据。

首先，为便于后面构造特征，将原始数据文件进行整合，并添加日期 date 变量。
其次，在测试集 action 表中，候选行为平均大约占整个波次所有行为 55% ，所以在训练集 action 表，将后 55% 的行为数据作为未知的待候选行为，因为训练集中的候选行为中的第一条为真实的下一条行为，将其二分类标签设置为 1 ，波次中的其他候选行为标签设置为 0 。第一步的任务转化为一个二分类问题。

这里根据日期、骑手 id 、波次构造新的组合特征为 group ，根据 group 、订单 id 、类型 id 构造新的组合特征为 group_tracking_id_type 。 
对测试集进行处理，删除不可能的记录，即测试集中既有'PICKUP'又有'DELIVERY'的'DELIVERY'。

这一步完成后最终得到 5 个文件，courier.plk（包含所有骑手的画像数据），order.plk（包含所有的订单数据），distance.plk（包含所有的导航数据），action_history.plk（所有波次中已知的行为数据），base_feature.plk（包含二分类标签的候选行为数据）。

#### 行为预测数据
这一步构造行为预测二分类所需要的特征，由于将所有日期文件合并在一起，通过前面构造的 group 特征定位一个唯一的波次。将分散在几个文件中的特征进行聚合，并构造新的特征。进行数据预处理，数据分箱和异常值截尾等操作。

#### 行为预测建模
利用 lightgbm 训练一个二分类模型，并获取下一步预测的 id 。在五折划分验证集的时候，需要使用 groupfold，保证同一个波次的行为不会既出现在训练集又出现在验证集。并且需要将训练集喂给模型之前需要将数据打乱。每个波次仅需要预测接下来的一次行为，所以每个波次只有一个1，所以在对测试集做预测时，只保留每个波次概率值最大的行为作为最后的预测结果。行为预测采用准确率评估，分母应该是波次总数，即在所有波次中预测对了几个波次的下一次行为。

#### 时间预测数据
将上两步形成的数据文件和 id 文件进行聚合，获得时间预测所需的数据集，并且构造新特征 timecha。

#### 时间预测建模
利用 lightgbm 训练一个回归模型。利用时间差 timecha 进行预测，可以降低 MAE ，预测完成后再与当前时间 current_time 相加。
最终导出完整 zip 文件。
